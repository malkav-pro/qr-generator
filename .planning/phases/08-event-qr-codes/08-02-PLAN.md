---
phase: 08-event-qr-codes
plan: 02
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - components/forms/qr-forms/EventForm.tsx
  - components/forms/qr-forms/index.ts
  - lib/registry.ts
  - components/TypeSelector.tsx
autonomous: true

must_haves:
  truths:
    - "User can enter event title, location, and description"
    - "User can select start and end date/time using datetime-local inputs"
    - "User can select timezone from searchable dropdown with friendly names"
    - "Form prevents submission when end time is before start time"
    - "QR preview updates in real-time as user types"
    - "Event type appears in TypeSelector and generates QR codes"
  artifacts:
    - path: "components/forms/qr-forms/EventForm.tsx"
      provides: "Event form with datetime pickers and timezone selector"
      min_lines: 150
    - path: "lib/registry.ts"
      provides: "EventForm registration"
      contains: "event: EventForm"
    - path: "components/TypeSelector.tsx"
      provides: "Event label in type selector"
      contains: "'Event'"
  key_links:
    - from: "components/forms/qr-forms/EventForm.tsx"
      to: "lib/formatters/event.ts"
      via: "schema and formatter imports"
      pattern: "import.*from.*formatters/event"
    - from: "lib/registry.ts"
      to: "components/forms/qr-forms/EventForm.tsx"
      via: "registry entry"
      pattern: "event:\\s*EventForm"
---

<objective>
Create EventForm component with datetime pickers and timezone selector

Purpose: Provide intuitive UI for creating calendar event QR codes with proper timezone handling
Output: Complete event QR type integrated into the application
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-event-qr-codes/08-RESEARCH.md
@.planning/phases/08-event-qr-codes/08-01-SUMMARY.md

# Prior patterns to follow
@components/forms/qr-forms/VCardForm.tsx
@components/forms/qr-forms/TelegramForm.tsx
@lib/registry.ts
@components/TypeSelector.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create EventForm component</name>
  <files>components/forms/qr-forms/EventForm.tsx</files>
  <action>
Create `components/forms/qr-forms/EventForm.tsx` following VCardForm pattern.

**Component structure:**
```typescript
'use client';

import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { useEffect, useMemo, useState } from 'react';
import { getTimeZones } from '@vvo/tzdb';
import { eventSchema, type EventData, formatEvent, getEventCharacterCount } from '@/lib/formatters/event';
import { FormFieldSet } from '../FormFieldSet';
```

**Form fields (in order):**
1. **Title** (required): Text input, maxLength 100
2. **Location** (optional): Text input, maxLength 200
3. **Description** (optional): Textarea, maxLength 500, with character counter
4. **Start Date/Time** (required): `<input type="datetime-local">`
5. **End Date/Time** (required): `<input type="datetime-local">`
6. **Timezone** (required): Searchable select/combobox

**Timezone selector implementation:**
Use `@vvo/tzdb` getTimeZones() to populate options:
```typescript
const timezones = getTimeZones({ includeUtc: true });
```

Create a searchable select that:
- Filters by typing (alternativeName, name, or mainCities)
- Displays friendly format: "Eastern Time (America/New_York)"
- Defaults to user's browser timezone using `Intl.DateTimeFormat().resolvedOptions().timeZone`

**Note on timezone selector:** You can use a simple native select with optgroups by continent, OR use a filtered input with datalist. Keep it simple - no need for a full Combobox from Headless UI. A filtered `<select>` with 400+ options grouped by continent is acceptable.

Alternative simple approach:
```typescript
<select>
  {timezones.map(tz => (
    <option key={tz.name} value={tz.name}>
      {tz.alternativeName} ({tz.name})
    </option>
  ))}
</select>
```

**Character counter:**
Use getEventCharacterCount() with same warning levels as VCardForm (1400 amber, 1500 red).

**Layout:**
- Group related fields with section headers like VCardForm
- "Event Details" section: title, location, description
- "Date & Time" section: start, end, timezone

**Cross-field validation display:**
The endDate field will show validation error "End time must be after start time" from Zod refine(). FormFieldSet handles error display automatically.

**Real-time QR preview:**
Use useEffect to call onDataChange with formatEvent output when form is valid (same pattern as VCardForm).
  </action>
  <verify>
Run `npm run build` - component should compile without errors.
Visual check: Form renders with all 6 fields in logical order.
Functional check: Entering valid data updates QR preview in real-time.
Validation check: Setting end time before start time shows error on end date field.
  </verify>
  <done>
- EventForm renders with title, location, description, start date, end date, timezone fields
- Timezone selector shows IANA timezones with friendly names
- Cross-field date validation displays error on endDate field
- Character counter shows event size with warning levels
- Real-time QR preview updates on valid input
  </done>
</task>

<task type="auto">
  <name>Task 2: Export EventForm and register in system</name>
  <files>components/forms/qr-forms/index.ts, lib/registry.ts, components/TypeSelector.tsx</files>
  <action>
**1. Export from qr-forms index:**
Add to `components/forms/qr-forms/index.ts`:
```typescript
export { EventForm } from './EventForm';
```

**2. Register in qrFormRegistry:**
Update `lib/registry.ts`:
- Add import: `import { EventForm } from '@/components/forms/qr-forms/EventForm';`
- Add registry entry: `event: EventForm,`

**3. Add label to TypeSelector:**
Update `components/TypeSelector.tsx` typeLabels:
```typescript
const typeLabels: Record<QRTypeKey, string> = {
  url: 'URL',
  text: 'Text',
  email: 'Email',
  whatsapp: 'WhatsApp',
  wifi: 'WiFi',
  vcard: 'vCard',
  telegram: 'Telegram',
  event: 'Event',
};
```

Follow existing patterns exactly - the system automatically picks up new types from QR_TYPES array.
  </action>
  <verify>
1. Run `npm run build` - no errors
2. Run `npm run dev` and check:
   - "Event" button appears in TypeSelector
   - Clicking "Event" shows EventForm
   - Filling valid event data generates QR code
3. Test iCalendar output by scanning QR code with phone camera
  </verify>
  <done>
- EventForm exported from components/forms/qr-forms/index.ts
- EventForm registered in qrFormRegistry as 'event'
- "Event" label appears in TypeSelector
- Full integration works: select type -> fill form -> generate QR
  </done>
</task>

<task type="auto">
  <name>Task 3: End-to-end verification</name>
  <files>None (verification only)</files>
  <action>
Verify complete Event QR type functionality:

1. **Type selection:**
   - Navigate to app in browser
   - TypeSelector shows 8 types including "Event"
   - Clicking "Event" renders EventForm

2. **Form validation:**
   - Title required - empty shows error
   - Location/description optional - can be blank
   - Start/end date required - empty shows error
   - Timezone required - has default from browser
   - End before start shows "End time must be after start time"

3. **QR generation:**
   - Fill valid data: Title "Team Meeting", Location "Room A", Description "Planning", dates in future, any timezone
   - QR code generates and displays
   - Character counter shows size

4. **iCalendar format (console check):**
   - Open browser DevTools
   - QR data should be iCalendar string with:
     - BEGIN:VCALENDAR and END:VCALENDAR
     - BEGIN:VEVENT and END:VEVENT
     - UID: with UUID format
     - DTSTAMP: current time in UTC
     - DTSTART: and DTEND: with Z suffix (UTC)
     - SUMMARY: event title

5. **Cross-device scan test (if available):**
   - Scan QR with phone camera
   - Should prompt to add event to calendar
   - Event times should display correctly in local timezone
  </action>
  <verify>
All checks pass. Event QR type is fully functional.
  </verify>
  <done>
- Event type selectable in UI
- Form validates all fields including cross-field date comparison
- QR codes generate valid iCalendar format
- Character counter warns at size thresholds
- (Bonus) Events import correctly when scanned
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run build` succeeds
2. App shows 8 QR types in TypeSelector (url, text, email, whatsapp, wifi, vcard, telegram, event)
3. Event form has: title, location, description, start date, end date, timezone
4. Timezone selector defaults to browser timezone
5. Cross-field validation prevents end before start
6. Generated QR contains valid iCalendar with UTC timestamps
7. Character counter shows event size with amber/red warnings
</verification>

<success_criteria>
- User can enter event title, location, description
- User can select start and end date/time using datetime-local inputs
- User can select timezone from dropdown with friendly names (defaults to browser TZ)
- Form validates end time is after start time
- QR preview updates in real-time
- Generated iCalendar includes UID, DTSTAMP, DTSTART, DTEND
- Event type fully integrated (TypeSelector shows it, registry loads it)
</success_criteria>

<output>
After completion, create `.planning/phases/08-event-qr-codes/08-02-SUMMARY.md`
</output>
